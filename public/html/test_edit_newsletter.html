<form id="form" method='POST' enctype="multipart/form-data">
    <label for="name">Newsletter Name:</label>
    <input type="text" id="name" name="name" required><br>

    <label for="category">Category:</label>
    <select id="category" name="category" required>
        <option value="Health">Health</option>
        <option value="Education">Education</option>
        <option value="Livelihood">Livelihood</option>
        <option value="Psychosocial">Psychosocial</option>
    </select><br>

    <label for="status">Status:</label>
    <select id="status" name="status" required>
        <option value="Past">Past</option>
        <option value="Ongoing">Ongoing</option>
        <option value="Upcoming">Upcoming</option>
    </select><br>

    <label for="photos">Main Photo:</label>
    <input type="file" id="photos" name="photos" accept="image/*" multiple required><br>

    <input type="text" id="id" name="id" style="display:none">
    <div id="photoDisplay">


    </div>
    <br />

    <input id="submit" type="submit" value="Submit">

    <script>
        // Retrieve project details from server using project id
        const newsletterID = new URLSearchParams(window.location.search).get('id');
        fetch(`/get_newsletter?id=${newsletterID}`)
            .then(response => response.json())
            .then(newsletter => {
                // Set default values for form fields
                console.log(newsletter)
                document.getElementById("id").value = newsletter._id;
                document.getElementById("name").value = newsletter.name;
                document.getElementById("category").value = newsletter.category;
                document.getElementById("status").value = newsletter.status;
                for (let i = 0; i < newsletter.photos.length; i++) {
                    document.getElementById("photoDisplay").innerHTML += "<img src='/imageByName?name=" + newsletter.photos[i] + "' style='width: 50%; height: auto;'><br/>";
                }
            });

        // Preview main photo
        document.getElementById("photos").addEventListener("change", function () {
            console.log(this.files);
            for (let i = 0; i < this.files.length; i++) {
                if (this.files[i]) {
                    const reader = new FileReader();
                    document.getElementById("photoDisplay").innerHTML = "";
                    reader.addEventListener("load", function () {
                        document.getElementById("photoDisplay").innerHTML += "<img src='" + this.result + "' style='width: 50%; height: auto;'><br/>";
                    });
                    reader.readAsDataURL(this.files[i]);
                }
            }
        });

        document.getElementById("submit").addEventListener("click", async (e) => {
            e.preventDefault();
            const res = await fetch("/edit_newsletter", {
                method: "PUT",
                body: new FormData(document.getElementById("form"))
            })
            if (res.status == 200) {
                // TODO: Redirect to the correct page.
                json = await res.json();
                window.location.replace("/html/test_view_newsletter.html?id=" + json);
            }
        })
    </script>
</form>