<form id="form" method='POST' enctype="multipart/form-data" action="/edit_event">
    <label for="name">Event Name/Title:</label>
    <input type="text" id="name" name="name" required><br>

    <label for="category">Category:</label>
    <select id="category" name="category" required>
        <option value="Health">Health</option>
        <option value="Education">Education</option>
        <option value="Livelihood">Livelihood</option>
        <option value="Psychosocial">Psychosocial</option>
    </select><br>

    <label for="status">Status:</label>
    <select id="status" name="status" required>
        <option value="Past">Past</option>
        <option value="Ongoing">Ongoing</option>
        <option value="Upcoming">Upcoming</option>
    </select><br>

    <label for="location">Location:</label>
    <input type="text" id="location" name="location" required><br>

    <label for="startdate">Start Date:</label>
    <input type="date" id="startdate" name="startdate" required><br>

    <label for="enddate">End Date:</label>
    <input type="date" id="enddate" name="enddate" required><br>

    <label for="mainPhoto">Main Photo:</label>
    <input type="file" id="mainPhoto" name="mainPhoto" accept="image/*"><br>
    <img id="thePhoto" style="width: 50%; height: auto; display: none"><br />

    <input type="text" id="id" name="id" style="display:none">

    <input id="submit" type="submit" value="Submit">

    <script>
        // Retrieve event details from server using event id
        const eventId = new URLSearchParams(window.location.search).get('id');
        fetch(`/get_event?id=${eventId}`)
            .then(response => response.json())
            .then(event => {
                // Set default values for form fields
                document.getElementById("id").value = event.id;
                document.getElementById("name").value = event.name;
                document.getElementById("category").value = event.category;
                document.getElementById("location").value = event.location;
                document.getElementById("startdate").value = event.startDate.slice(0, 10);
                document.getElementById("enddate").value = event.endDate.slice(0, 10);
                document.getElementById("status").value = event.status;
                document.getElementById('thePhoto').src = '/imageByName?name=' + event.mainPhoto;
                document.getElementById("thePhoto").style = "width: 50%; height: auto";
            });

        // Preview main photo
        document.getElementById("mainPhoto").addEventListener("change", function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.addEventListener("load", function () {
                    document.getElementById("thePhoto").src = this.result;
                    document.getElementById("thePhoto").style = "width: 50%; height: auto";
                });
                reader.readAsDataURL(file);
            }
        });
        document.getElementById("submit").addEventListener("click", async (e) => {
            e.preventDefault();
            var formData = new FormData(document.getElementById("form"));
            const res = await fetch("/edit_event", {
                method: "PUT",
                body: formData
            })
            console.log(res);
            if (res.status == 200) {
                // TODO: Redirect to the correct page.
                json = await res.json();
                window.location.replace("/html/test_view_event.html?id=" + json);
            }
        })
    </script>
</form>